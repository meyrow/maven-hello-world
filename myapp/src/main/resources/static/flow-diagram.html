<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitOps Flow Diagram - Interactive</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .profile-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .header-text {
            flex: 1;
        }

        .header h1 {
            color: #2d3748;
            margin-bottom: 5px;
            font-size: 32px;
        }

        .header p {
            color: #718096;
            margin-top: 5px;
            font-size: 16px;
        }

        .header-links {
            text-align: center;
        }

        .back-link {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin: 5px;
            font-weight: 600;
            transition: background 0.3s;
        }

        .back-link:hover {
            background: #5a67d8;
        }

        .diagram {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow-x: auto;
        }

        .flow-container {
            min-width: 1200px;
            padding: 20px;
        }

        .flow-stage {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            transition: all 0.3s;
        }

        .flow-stage:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            transform: translateX(5px);
        }

        .stage-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .stage-number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .stage-title {
            font-size: 22px;
            font-weight: bold;
            color: #2d3748;
        }

        .stage-icon {
            font-size: 30px;
            margin-left: auto;
        }

        .stage-content {
            margin-left: 55px;
            color: #4a5568;
        }

        .stage-detail {
            background: white;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 8px 0;
            border-left: 3px solid #667eea;
        }

        .arrow {
            text-align: center;
            font-size: 30px;
            color: #667eea;
            margin: 10px 0;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .legend {
            background: #edf2f7;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .legend h3 {
            color: #2d3748;
            margin-bottom: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            color: #4a5568;
        }

        .legend-icon {
            font-size: 20px;
            width: 30px;
        }

        .timing {
            background: #fef5e7;
            color: #f39c12;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
            margin-top: 10px;
        }

        .highlight-box {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .highlight-box h4 {
            color: #155724;
            margin-bottom: 10px;
        }

        code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="header-content">
            <div class="profile-image">
                <img
                        src="https://lh3.googleusercontent.com/a/ACg8ocLrnyOd_xegnVjfkJFaOu0WsYNdWopOJv2qeK4BTMvoEPNe7Sn8=s340-p-k-no"
                        alt="Ilan Meyrowitsch"
                        onerror="this.parentElement.innerHTML='IL'; this.parentElement.style.display='flex'; this.parentElement.style.alignItems='center'; this.parentElement.style.justifyContent='center'; this.parentElement.style.fontSize='24px'; this.parentElement.style.fontWeight='bold'; this.parentElement.style.color='white'; this.parentElement.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'"
                />
            </div>
            <div class="header-text">
                <h1>üîÑ Complete GitOps Deployment Flow</h1>
                <p>From Code Commit to Production - Fully Automated</p>
                <p style="font-size: 14px; margin-top: 5px;">By Ilan Meyrowitsch</p>
            </div>
        </div>
        <div class="header-links">
            <a href="/" class="back-link">üè† Dashboard</a>
            <a href="/tutorial.html" class="back-link">üìö Tutorial</a>
            <a href="https://34.61.82.236" class="back-link" target="_blank">üîÑ ArgoCD</a>
        </div>
    </div>

    <div class="diagram">
        <div class="flow-container">

            <!-- Stage 1 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">1</div>
                    <div class="stage-title">Developer Commits Code</div>
                    <div class="stage-icon">üë®‚Äçüíª</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>Action:</strong> Developer makes changes to application code
                    </div>
                    <div class="stage-detail">
                        <strong>Commands:</strong><br>
                        <code>git add .</code><br>
                        <code>git commit -m "feat: new feature"</code><br>
                        <code>git push origin master</code>
                    </div>
                    <div class="stage-detail">
                        <strong>Location:</strong> Local workstation ‚Üí GitHub repository
                    </div>
                    <div class="timing">‚è±Ô∏è Instant</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 2 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">2</div>
                    <div class="stage-title">GitHub Actions Triggered</div>
                    <div class="stage-icon">‚ö°</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>Trigger:</strong> Push to master/main branch
                    </div>
                    <div class="stage-detail">
                        <strong>Workflow:</strong> .github/workflows/ci-cd.yml
                    </div>
                    <div class="stage-detail">
                        <strong>Jobs:</strong> build-and-push, test-docker-image
                    </div>
                    <div class="timing">‚è±Ô∏è Starts in 5 seconds</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 3 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">3</div>
                    <div class="stage-title">Maven Build</div>
                    <div class="stage-icon">üî®</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>Action:</strong> Compile Java code and create JAR
                    </div>
                    <div class="stage-detail">
                        <strong>Command:</strong> <code>mvn clean package -Dmaven.test.skip=true</code>
                    </div>
                    <div class="stage-detail">
                        <strong>Version Extraction:</strong> Read from pom.xml + Git SHA
                    </div>
                    <div class="stage-detail">
                        <strong>Output:</strong> maven-hello-world-1.0.1.jar
                    </div>
                    <div class="timing">‚è±Ô∏è 1-2 minutes</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 4 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">4</div>
                    <div class="stage-title">Docker Image Build</div>
                    <div class="stage-icon">üê≥</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>Strategy:</strong> Multi-stage Dockerfile
                    </div>
                    <div class="stage-detail">
                        <strong>Stage 1:</strong> Maven build (builder) - 755MB
                    </div>
                    <div class="stage-detail">
                        <strong>Stage 2:</strong> Runtime with JRE only - 328MB (57% smaller!)
                    </div>
                    <div class="stage-detail">
                        <strong>Security:</strong> Non-root user (appuser), minimal attack surface
                    </div>
                    <div class="stage-detail">
                        <strong>Optimization:</strong> Layer caching, .dockerignore
                    </div>
                    <div class="timing">‚è±Ô∏è 2-3 minutes</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 5 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">5</div>
                    <div class="stage-title">Version Tagging</div>
                    <div class="stage-icon">üè∑Ô∏è</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>Strategy:</strong> Base Version (pom.xml) + Git SHA
                    </div>
                    <div class="stage-detail">
                        <strong>Format:</strong> {base-version}-{git-sha}
                    </div>
                    <div class="stage-detail">
                        <strong>Example:</strong> 1.0.1-abc123f
                    </div>
                    <div class="stage-detail">
                        <strong>Tags Created:</strong><br>
                        - <code>1.0.1-abc123f</code> (unique - used by ArgoCD)<br>
                        - <code>1.0.1</code> (base version - stable reference)<br>
                        - <code>latest</code> (most recent - convenience)
                    </div>
                    <div class="stage-detail">
                        <strong>Why Git SHA?</strong> Uniqueness, traceability, auto-deployment, rollback capability
                    </div>
                    <div class="timing">‚è±Ô∏è Instant</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 6 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">6</div>
                    <div class="stage-title">Push to Docker Hub</div>
                    <div class="stage-icon">üêã</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>Registry:</strong> Docker Hub (public container registry)
                    </div>
                    <div class="stage-detail">
                        <strong>Repository:</strong> ilanm/maven-hello-world
                    </div>
                    <div class="stage-detail">
                        <strong>Authentication:</strong> Docker Hub credentials (GitHub secrets)
                    </div>
                    <div class="stage-detail">
                        <strong>Result:</strong> Container image available publicly at<br>
                        hub.docker.com/r/ilanm/maven-hello-world
                    </div>
                    <div class="stage-detail">
                        <strong>Image Size:</strong> 328MB (optimized with multi-stage build)
                    </div>
                    <div class="timing">‚è±Ô∏è 1-2 minutes</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 7 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">7</div>
                    <div class="stage-title">Update Helm Chart</div>
                    <div class="stage-icon">‚éà</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>File:</strong> helm-chart/values.yaml
                    </div>
                    <div class="stage-detail">
                        <strong>Update:</strong> <code>image.tag: "1.0.1-abc123f"</code>
                    </div>
                    <div class="stage-detail">
                        <strong>Command:</strong> <code>sed -i "s|tag:.*|tag: \"$VERSION\"|g" values.yaml</code>
                    </div>
                    <div class="stage-detail">
                        <strong>Why?</strong> Helm chart is the deployment configuration that ArgoCD reads
                    </div>
                    <div class="timing">‚è±Ô∏è Instant</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 8 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">8</div>
                    <div class="stage-title">Commit to Git</div>
                    <div class="stage-icon">üìù</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>Action:</strong> GitHub Actions commits updated Helm chart
                    </div>
                    <div class="stage-detail">
                        <strong>Commit Message:</strong> "chore: update image tag to 1.0.1-abc123f"
                    </div>
                    <div class="stage-detail">
                        <strong>Author:</strong> GitHub Actions (automated commit)
                    </div>
                    <div class="stage-detail">
                        <strong>Result:</strong> Git is now the single source of truth for deployment state
                    </div>
                    <div class="stage-detail">
                        <strong>GitOps Principle:</strong> All cluster state changes go through Git
                    </div>
                    <div class="timing">‚è±Ô∏è Instant</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 9 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">9</div>
                    <div class="stage-title">ArgoCD Detects Change</div>
                    <div class="stage-icon">üëÅÔ∏è</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>Polling:</strong> ArgoCD checks Git repository every 3 minutes
                    </div>
                    <div class="stage-detail">
                        <strong>Detection:</strong> Helm chart values.yaml changed
                    </div>
                    <div class="stage-detail">
                        <strong>Comparison:</strong> Git state vs Cluster state
                    </div>
                    <div class="stage-detail">
                        <strong>Status Change:</strong> Application marked as "OutOfSync"
                    </div>
                    <div class="stage-detail">
                        <strong>Auto-Sync:</strong> Enabled (automatic deployment triggered)
                    </div>
                    <div class="stage-detail">
                        <strong>Self-Heal:</strong> Enabled (reverts manual cluster changes)
                    </div>
                    <div class="timing">‚è±Ô∏è 0-3 minutes (polling interval)</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 10 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">10</div>
                    <div class="stage-title">ArgoCD Syncs</div>
                    <div class="stage-icon">üîÑ</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>Action:</strong> Apply Kubernetes manifests to cluster
                    </div>
                    <div class="stage-detail">
                        <strong>Process:</strong><br>
                        1. Render Helm templates with new values<br>
                        2. Generate Kubernetes YAML manifests<br>
                        3. Calculate diff between Git and Cluster<br>
                        4. Apply changes to GKE cluster
                    </div>
                    <div class="stage-detail">
                        <strong>Features:</strong> Self-Heal, Prune (delete removed resources), Auto-Create Namespace
                    </div>
                    <div class="stage-detail">
                        <strong>Sync Strategy:</strong> Automated (no manual approval needed)
                    </div>
                    <div class="timing">‚è±Ô∏è 30 seconds</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 11 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">11</div>
                    <div class="stage-title">Kubernetes Pulls Image</div>
                    <div class="stage-icon">‚ò∏Ô∏è</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>Source:</strong> Docker Hub registry
                    </div>
                    <div class="stage-detail">
                        <strong>Image:</strong> ilanm/maven-hello-world:1.0.1-abc123f
                    </div>
                    <div class="stage-detail">
                        <strong>Pull Policy:</strong> IfNotPresent (new tag forces pull)
                    </div>
                    <div class="stage-detail">
                        <strong>Nodes:</strong> Both GKE nodes pull the image (multi-node cluster)
                    </div>
                    <div class="stage-detail">
                        <strong>Cache:</strong> Image layers cached on nodes for future use
                    </div>
                    <div class="stage-detail">
                        <strong>Why unique tags matter:</strong> Kubernetes won't pull updated images with same tag!
                    </div>
                    <div class="timing">‚è±Ô∏è 30-60 seconds (first pull), instant (cached)</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 12 -->
            <div class="flow-stage">
                <div class="stage-header">
                    <div class="stage-number">12</div>
                    <div class="stage-title">Rolling Update</div>
                    <div class="stage-icon">üîÑ</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail">
                        <strong>Strategy:</strong> RollingUpdate (zero downtime deployment)
                    </div>
                    <div class="stage-detail">
                        <strong>Process:</strong><br>
                        1. Create new pod with version 1.0.1-abc123f on Node 2<br>
                        2. Wait for readiness probe to pass (15s delay + checks)<br>
                        3. Add new pod to service endpoints (starts receiving traffic)<br>
                        4. Terminate old pod on Node 1 (graceful shutdown)<br>
                        5. Create new pod on Node 1<br>
                        6. Terminate last old pod on Node 2
                    </div>
                    <div class="stage-detail">
                        <strong>Health Checks:</strong> Liveness probe (30s delay) + Readiness probe (15s delay)
                    </div>
                    <div class="stage-detail">
                        <strong>Max Surge:</strong> 1 extra pod allowed during update
                    </div>
                    <div class="stage-detail">
                        <strong>Max Unavailable:</strong> 0 (ensures at least 2 pods always running)
                    </div>
                    <div class="stage-detail">
                        <strong>Result:</strong> Zero downtime! Traffic continuously served ‚úÖ
                    </div>
                    <div class="timing">‚è±Ô∏è 1-2 minutes</div>
                </div>
            </div>

            <div class="arrow">‚¨áÔ∏è</div>

            <!-- Stage 13 -->
            <div class="flow-stage" style="border-color: #28a745; background: #d4edda;">
                <div class="stage-header">
                    <div class="stage-number" style="background: #28a745;">‚úì</div>
                    <div class="stage-title" style="color: #155724;">Production Deployed!</div>
                    <div class="stage-icon">üéâ</div>
                </div>
                <div class="stage-content">
                    <div class="stage-detail" style="border-color: #28a745; background: white;">
                        <strong>Status:</strong> Application running with new version
                    </div>
                    <div class="stage-detail" style="border-color: #28a745; background: white;">
                        <strong>URL:</strong> http://34.58.22.204
                    </div>
                    <div class="stage-detail" style="border-color: #28a745; background: white;">
                        <strong>Version:</strong> 1.0.1-abc123f visible in dashboard and /health endpoint
                    </div>
                    <div class="stage-detail" style="border-color: #28a745; background: white;">
                        <strong>ArgoCD Status:</strong> Synced ‚úÖ Healthy ‚úÖ
                    </div>
                    <div class="stage-detail" style="border-color: #28a745; background: white;">
                        <strong>Pods:</strong> 2 replicas running on 2 different nodes (HA)
                    </div>
                    <div class="stage-detail" style="border-color: #28a745; background: white;">
                        <strong>Load Balancer:</strong> External IP assigned, traffic flowing
                    </div>
                </div>
            </div>

            <!-- Summary Box -->
            <div class="highlight-box">
                <h4>üìä Complete Pipeline Summary</h4>
                <div class="legend-item">
                    <div class="legend-icon">‚è±Ô∏è</div>
                    <strong>Total Time:</strong> ~8-12 minutes from commit to production
                </div>
                <div class="legend-item">
                    <div class="legend-icon">ü§ñ</div>
                    <strong>Manual Steps:</strong> 1 (git push only!)
                </div>
                <div class="legend-item">
                    <div class="legend-icon">üîÑ</div>
                    <strong>Automated Steps:</strong> 12 (fully automated CI/CD)
                </div>
                <div class="legend-item">
                    <div class="legend-icon">‚úÖ</div>
                    <strong>Zero Downtime:</strong> Rolling updates with health checks
                </div>
                <div class="legend-item">
                    <div class="legend-icon">üìù</div>
                    <strong>Audit Trail:</strong> Complete history in Git (every change tracked)
                </div>
                <div class="legend-item">
                    <div class="legend-icon">üîí</div>
                    <strong>Security:</strong> Multi-stage Docker, non-root user, minimal image
                </div>
                <div class="legend-item">
                    <div class="legend-icon">üè∑Ô∏è</div>
                    <strong>Versioning:</strong> Unique Git SHA tags for traceability
                </div>
                <div class="legend-item">
                    <div class="legend-icon">üîÑ</div>
                    <strong>Rollback:</strong> Simple git revert to previous version
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <h3>üîë Key Technologies</h3>
                <div class="legend-item">
                    <div class="legend-icon">üë®‚Äçüíª</div>
                    <strong>Development:</strong> Java 17, Spring Boot, React, Maven
                </div>
                <div class="legend-item">
                    <div class="legend-icon">‚ö°</div>
                    <strong>CI/CD:</strong> GitHub Actions (automated workflows)
                </div>
                <div class="legend-item">
                    <div class="legend-icon">üê≥</div>
                    <strong>Containerization:</strong> Docker (multi-stage builds), Docker Hub
                </div>
                <div class="legend-item">
                    <div class="legend-icon">üîÑ</div>
                    <strong>GitOps:</strong> ArgoCD (continuous delivery), Helm (package manager)
                </div>
                <div class="legend-item">
                    <div class="legend-icon">‚ò∏Ô∏è</div>
                    <strong>Infrastructure:</strong> Google Kubernetes Engine (GKE Standard, 2 nodes)
                </div>
                <div class="legend-item">
                    <div class="legend-icon">üìä</div>
                    <strong>Monitoring:</strong> Kubernetes health probes, ArgoCD dashboard
                </div>
                <div class="legend-item">
                    <div class="legend-icon">üè∑Ô∏è</div>
                    <strong>Versioning:</strong> Semantic versioning + Git SHA (pom.xml + Git)
                </div>
            </div>

            <!-- Architecture Highlights -->
            <div class="legend" style="margin-top: 20px; background: #fff3cd; border: 2px solid #ffc107;">
                <h3 style="color: #856404;">‚öôÔ∏è Architecture Highlights</h3>
                <div class="legend-item" style="color: #856404;">
                    <div class="legend-icon">üèóÔ∏è</div>
                    <strong>Multi-Node Cluster:</strong> 2 nodes for high availability and zero-downtime deployments
                </div>
                <div class="legend-item" style="color: #856404;">
                    <div class="legend-icon">üîê</div>
                    <strong>Security:</strong> Non-root containers, minimal base images, no build tools in production
                </div>
                <div class="legend-item" style="color: #856404;">
                    <div class="legend-icon">üìè</div>
                    <strong>Image Size:</strong> 328MB (57% reduction through multi-stage builds)
                </div>
                <div class="legend-item" style="color: #856404;">
                    <div class="legend-icon">üîÑ</div>
                    <strong>Auto-Scaling:</strong> HPA configured (2-10 replicas based on CPU/memory)
                </div>
                <div class="legend-item" style="color: #856404;">
                    <div class="legend-icon">üîç</div>
                    <strong>Traceability:</strong> Every deployment traced to exact Git commit
                </div>
            </div>

            <!-- Back Links -->
            <div style="text-align: center; margin-top: 40px;">
                <a href="/" class="back-link" style="font-size: 18px; padding: 15px 30px;">üè† Back to Dashboard</a>
                <a href="/tutorial.html" class="back-link" style="font-size: 18px; padding: 15px 30px;">üìö Read Tutorial</a>
            </div>
        </div>
    </div>
</div>
</body>
</html>